<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C - Lodge Complaint</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/report.css') }}">
</head>
<body>
    <!-- Animated background blobs -->
    <div class="bg-shape shape1"></div>
    <div class="bg-shape shape2"></div>
    <div class="bg-shape shape3"></div>
    
    <!-- HOME BUTTON -->
    <a href="/" class="home-btn">
        <span class="home-icon">üè†</span> Home
    </a>

    <!-- Centered Form -->
    <div class="container fade-in-up">
        <h2>Lodge Your <span>Complaint</span></h2>

        <form method="POST" action="/submit_complaint" enctype="multipart/form-data" class="form-card">
            
            <!-- Hidden input for voice file -->
            <input type="file" name="voice_complaint" id="voice_proof_input" style="display: none;">

            <!-- Full Name -->
            <div class="input-group">
                <label for="name">Full Name:</label>
                <input type="text" id="name" name="name" placeholder="Enter your full name" required>
            </div>

            <!-- Phone -->
            <div class="input-group">
                <label for="phone">Phone Number:</label>
                <input type="tel" id="phone" name="phone" pattern="[0-9]{10}" maxlength="10" placeholder="Enter 10-digit phone number" required>
            </div>

            <!-- District -->
            <div class="input-group">
                <label for="district">District Name:</label>
                <select id="district" name="district" required>
                    <option value="">-- Select District --</option>
                    <option value="angul">Angul</option>
                    <option value="balangir">Balangir</option>
                    <option value="balasore">Balasore</option>
                    <option value="bargarh">Bargarh</option>
                    <option value="bhadrak">Bhadrak</option>
                    <option value="boudh">Boudh</option>
                    <option value="cuttack">Cuttack</option>
                    <option value="deogarh">Deogarh</option>
                    <option value="dhenkanal">Dhenkanal</option>
                    <option value="gajapati">Gajapati</option>
                    <option value="ganjam">Ganjam</option>
                    <option value="jagatsinghpur">Jagatsinghpur</option>
                    <option value="jajpur">Jajpur</option>
                    <option value="jharsuguda">Jharsuguda</option>
                    <option value="kalahandi">Kalahandi</option>
                    <option value="kandhamal">Kandhamal</option>
                    <option value="kendrapara">Kendrapara</option>
                    <option value="keonjhar">Keonjhar</option>
                    <option value="khordha">Khordha</option>
                    <option value="koraput">Koraput</option>
                    <option value="malkangiri">Malkangiri</option>
                    <option value="mayurbhanj">Mayurbhanj</option>
                    <option value="nabarangpur">Nabarangpur</option>
                    <option value="nayagarh">Nayagarh</option>
                    <option value="nuapada">Nuapada</option>
                    <option value="puri">Puri</option>
                    <option value="rayagada">Rayagada</option>
                    <option value="sambalpur">Sambalpur</option>
                    <option value="subarnapur">Subarnapur (Sonepur)</option>
                    <option value="sundargarh">Sundargarh</option>
                </select>
            </div>

            <!-- PIN Code -->
            <div class="input-group">
                <label for="pincode">PIN Code:</label>
                <input type="text" id="pincode" name="pincode" pattern="[0-9]{6}" maxlength="6" placeholder="Enter 6-digit PIN code" required>
            </div>

            <!-- Block -->
            <div class="input-group">
                <label for="block">Block Name:</label>
                <input type="text" id="block" name="block" placeholder="Enter your block name" required>
            </div>

            <!-- Gram Panchayat -->
            <div class="input-group">
                <label for="gp">Gram Panchayat (GP) Name:</label>
                <input type="text" id="gp" name="gp" placeholder="Enter GP name" required>
            </div>

            <!-- Village -->
            <div class="input-group full-width">
                <label for="village">Village Name:</label>
                <input type="text" id="village" name="village" placeholder="Enter your village name" required>
            </div>

            <!-- Landmark -->
            <div class="input-group full-width">
                <label for="landmark">Landmark:</label>
                <input type="text" id="landmark" name="landmark" placeholder="Enter landmark" required>
            </div>

            <!-- Department -->
            <div class="input-group full-width">
                <label for="department">Department Concerned:</label>
                <select id="department" name="department" required>
                    <option value="">-- Select Department --</option>
                    <option value="Water Supply">Water Supply</option>
                    <option value="Electricity">Electricity</option>
                    <option value="Roads & Transport">Roads & Transport</option>
                    <option value="Health & Sanitation">Health & Sanitation</option>
                    <option value="Education">Education</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <!-- Complaint -->
            <div class="input-group full-width">
                <label for="complaint">Complaint Details:</label>
                <textarea id="complaint" name="complaint" rows="5" placeholder="Describe your issue in detail"></textarea>
                <!-- Voice Recorder UI -->
                <div class="voice-recorder">
                    <button type="button" id="recordBtn" class="record-btn"><i class="fas fa-microphone"></i></button>
                    <span id="timer" class="timer">00:00</span>
                    <audio id="audioPlayback" controls class="hidden"></audio>
                </div>
            </div>

            <!-- Proof Upload -->
            <div class="input-group full-width">
                <label for="proof">Attach Proof (Image/Video):</label>
                <input type="file" id="proof" name="proof" accept="image/*,video/*">
            </div>

            <!-- Buttons -->
            <div class="btn-group">
                <button type="submit" class="btn">Submit Complaint</button>
                <button type="reset" class="btn-outline">Clear Form</button>
            </div>
        </form>
    </div>

    <!-- Footer -->
    <footer>
        <p>¬© 2025 C | Designed with ‚ù§Ô∏è for better governance</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- VOICE RECORDER SCRIPT ---
            const recordBtn = document.getElementById('recordBtn');
            const timerEl = document.getElementById('timer');
            const audioPlayback = document.getElementById('audioPlayback');
            const voiceProofInput = document.getElementById('voice_proof_input');

            let isRecording = false;
            let mediaRecorder;
            let audioChunks = [];
            let timerInterval;

            recordBtn.addEventListener('click', () => {
                if (isRecording) {
                    stopRecording();
                } else {
                    startRecording();
                }
            });

            async function startRecording() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        
                        audioPlayback.src = audioUrl;
                        audioPlayback.classList.remove('hidden');
                        recordBtn.classList.add('hidden');
                        timerEl.classList.add('hidden');

                        const audioFile = new File([audioBlob], `voice_complaint_${Date.now()}.webm`, { type: 'audio/webm' });
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(audioFile);
                        voiceProofInput.files = dataTransfer.files;
                    };

                    audioChunks = [];
                    mediaRecorder.start();
                    isRecording = true;
                    recordBtn.classList.add('recording');
                    startTimer();
                } catch (err) {
                    alert("Microphone access was denied. Please allow microphone access in your browser settings.");
                }
            };

            function stopRecording() {
                mediaRecorder.stop();
                isRecording = false;
                recordBtn.classList.remove('recording');
                stopTimer();
            };

            function startTimer() {
                let seconds = 0;
                timerInterval = setInterval(() => {
                    seconds++;
                    const min = Math.floor(seconds / 60).toString().padStart(2, '0');
                    const sec = (seconds % 60).toString().padStart(2, '0');
                    timerEl.textContent = `${min}:${sec}`;
                }, 1000);
            };

            function stopTimer() {
                clearInterval(timerInterval);
                timerEl.textContent = '00:00';
            };
        });
    </script>
</body>
</html>


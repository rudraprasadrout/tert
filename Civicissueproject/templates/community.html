<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Public Feedback Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/comunity.css') }}">
</head>
<body>
  <!-- Background shapes -->
  <div class="bg-shape shape1"></div>
  <div class="bg-shape shape2"></div>

  <!-- Home button -->
  <a href="{{ url_for('home') }}" class="home-btn">
    <i class="fas fa-home"></i> Home
  </a>

  <!-- Header -->
  <header>
    <h2><i class="fas fa-comments"></i> Public Feedback Dashboard</h2>
  </header>

  <!-- Filter Section -->
  <div class="filter-section">
    <form method="get" action="{{ url_for('community') }}" style="display: contents;">
      <div class="filter-control">
        <label for="department-filter"><i class="fas fa-building"></i> Filter by Type</label>
        <select id="department-filter" name="department" onchange="this.form.submit()">
          <option value="all" {% if selected_department == 'all' %}selected{% endif %}>All Types</option>
          <option value="general" {% if selected_department == 'general' %}selected{% endif %}>General Feedback</option>
          <option value="complaint" {% if selected_department == 'complaint' %}selected{% endif %}>Complaint Process</option>
          <option value="suggestion" {% if selected_department == 'suggestion' %}selected{% endif %}>Suggestion</option>
          <option value="technical" {% if selected_department == 'technical' %}selected{% endif %}>Technical Issue</option>
          <option value="other" {% if selected_department == 'other' %}selected{% endif %}>Other</option>
        </select>
      </div>

      <div class="filter-control">
        <label for="rating-filter"><i class="fas fa-star"></i> Filter by Rating</label>
        <select id="rating-filter" name="rating" onchange="this.form.submit()">
          <option value="all" {% if selected_rating == 'all' %}selected{% endif %}>All Ratings</option>
          <option value="5" {% if selected_rating == '5' %}selected{% endif %}>5 Stars</option>
          <option value="4" {% if selected_rating == '4' %}selected{% endif %}>4+ Stars</option>
          <option value="3" {% if selected_rating == '3' %}selected{% endif %}>3+ Stars</option>
          <option value="2" {% if selected_rating == '2' %}selected{% endif %}>2+ Stars</option>
          <option value="1" {% if selected_rating == '1' %}selected{% endif %}>1+ Stars</option>
        </select>
      </div>

      <div class="filter-control">
        <label for="sort-by"><i class="fas fa-sort"></i> Sort By</label>
        <select id="sort-by" name="sort" onchange="this.form.submit()">
          <option value="newest" {% if selected_sort == 'newest' %}selected{% endif %}>Newest First</option>
          <option value="oldest" {% if selected_sort == 'oldest' %}selected{% endif %}>Oldest First</option>
          <option value="highest" {% if selected_sort == 'highest' %}selected{% endif %}>Highest Rating</option>
          <option value="lowest" {% if selected_sort == 'lowest' %}selected{% endif %}>Lowest Rating</option>
        </select>
      </div>
    </form>
  </div>

  <!-- Feedback Container -->
  <section class="feedback-container">
    {% if feedbacks %}
      {% for fb in feedbacks %}
      <div class="feedback-card">
        <div class="feedback-header">
          <div class="feedback-id">
            <i class="fas fa-comment"></i> Feedback #{{ fb[0] }}
          </div>
          <div class="feedback-date">
            <i class="far fa-calendar"></i> 
            {% if fb[6] %}
              {{ fb[6]|datetimeformat("%d %b %Y") }}
            {% endif %}
          </div>
        </div>

        <div class="feedback-content">
          <p>{{ fb[5] }}</p>
        </div>

        <div class="feedback-rating">
          {% for i in range(fb[4]) %}
            <span class="star"><i class="fas fa-star"></i></span>
          {% endfor %}
          {% for i in range(5 - fb[4]) %}
            <span class="star"><i class="far fa-star"></i></span>
          {% endfor %}
        </div>

        <div class="feedback-department">
          {% if fb[3] == 'general' %}
            <i class="fas fa-comments"></i> General Feedback
          {% elif fb[3] == 'complaint' %}
            <i class="fas fa-file-alt"></i> Complaint Process
          {% elif fb[3] == 'suggestion' %}
            <i class="fas fa-lightbulb"></i> Suggestion
          {% elif fb[3] == 'technical' %}
            <i class="fas fa-bug"></i> Technical Issue
          {% elif fb[3] == 'other' %}
            <i class="fas fa-ellipsis-h"></i> Other
          {% else %}
            <i class="fas fa-building"></i> {{ fb[3] }}
          {% endif %}
        </div>

        <div class="feedback-footer">
          <div class="feedback-user">
            <i class="fas fa-user"></i> 
            {% if fb[1] and fb[1].strip() != "" %}
              {{ fb[1] }}
            {% else %}
              Anonymous User
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <div class="no-data">
        <i class="fas fa-inbox"></i> No feedback available yet.
      </div>
    {% endif %}
  </section>

</body>
</html>
